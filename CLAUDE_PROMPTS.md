# Claude CLI Prompt 示例集

本文档提供了在开发 UAV Simulator 过程中使用 Claude CLI 的 prompt 示例。

## 基础开发 Prompts

### 1. 创建新模块骨架

```
我需要创建无人机物理模型模块。请在 Source/uav_simulator/Physics/ 目录下创建以下文件：

1. UAVDynamics.h - 无人机动力学类头文件
2. UAVDynamics.cpp - 实现文件
3. MotorModel.h - 电机模型类头文件
4. MotorModel.cpp - 实现文件

要求：
- 使用 Unreal Engine 5.7 的编码规范
- UAVDynamics 类应该继承自 UActorComponent
- 包含六自由度动力学模型的基础框架
- 使用 FVector 和 FRotator 表示位置和姿态
- 添加必要的 UPROPERTY 和 UFUNCTION 宏
- 包含详细的中文注释说明每个函数的作用
```

### 2. 实现具体算法

```
请帮我在 UAVDynamics.cpp 中实现四旋翼无人机的动力学模型。

需求：
- 实现 UpdateDynamics(float DeltaTime) 函数
- 基于牛顿-欧拉方程计算六自由度运动
- 输入：4个电机的推力值（TArray<float> MotorThrusts）
- 输出：更新无人机的位置、速度、姿态、角速度
- 考虑重力、空气阻力、陀螺效应
- 使用 Unreal 的坐标系统（左手坐标系，Z轴向上）

参考物理参数：
- 质量：1.5kg
- 转动惯量：Ixx=0.029, Iyy=0.029, Izz=0.055 kg·m²
- 臂长：0.225m
```

### 3. 代码审查和优化

```
请审查 Source/uav_simulator/Control/AttitudeController.cpp 文件，重点关注：

1. 性能优化：是否有不必要的计算或内存分配
2. 数值稳定性：PID 控制器是否会出现积分饱和或数值溢出
3. 代码规范：是否符合 UE5 编码标准
4. 潜在 bug：边界条件、空指针、除零等
5. 可读性：是否需要添加注释或重构

请给出具体的改进建议和修改后的代码。
```

### 4. 调试问题

```
我的无人机在悬停时出现震荡，姿态控制器参数如下：
- Kp_roll = 6.0, Ki_roll = 0.1, Kd_roll = 0.5
- Kp_pitch = 6.0, Ki_pitch = 0.1, Kd_pitch = 0.5
- Kp_yaw = 4.0, Ki_yaw = 0.05, Kd_yaw = 0.3

请帮我：
1. 分析可能的原因（控制参数、动力学模型、数值积分等）
2. 建议调试步骤
3. 提供参数调优建议
4. 如果需要，修改控制器代码以提高稳定性
```

## 模块开发 Prompts

### 5. 传感器模拟

```
请实现一个 IMU 传感器模拟类（Source/uav_simulator/Sensors/IMUSensor.h/cpp）。

功能需求：
- 模拟加速度计：测量三轴加速度（包含重力）
- 模拟陀螺仪：测量三轴角速度
- 添加真实的传感器噪声（高斯白噪声 + bias）
- 添加传感器更新频率限制（如 1000Hz）
- 支持传感器校准和偏置设置
- 提供 Blueprint 可调用的接口

参考真实 IMU 参数（如 MPU6050）：
- 加速度计噪声密度：400 μg/√Hz
- 陀螺仪噪声密度：0.01 °/s/√Hz
- 加速度计 bias 稳定性：±40 mg
- 陀螺仪 bias 稳定性：±10 °/s
```

### 6. 轨迹规划算法

```
请在 Source/uav_simulator/Planning/TrajectoryOptimizer.cpp 中实现最小 snap 轨迹生成算法。

输入：
- 一系列航点（TArray<FVector> Waypoints）
- 每段轨迹的时间分配（TArray<float> SegmentTimes）
- 起点和终点的速度、加速度约束

输出：
- 多项式轨迹系数（用于实时轨迹查询）
- 轨迹采样点（用于可视化）

要求：
- 使用分段多项式（7次或9次）
- 保证位置、速度、加速度、jerk、snap 连续性
- 使用 QP 求解器（可以使用 Eigen 库或自己实现简化版本）
- 提供轨迹评估函数（GetPosition, GetVelocity, GetAcceleration）
```

### 7. 多机编队控制

```
请实现一个基于领航-跟随法的编队控制器（Source/uav_simulator/MultiAgent/FormationController.h/cpp）。

功能：
- 支持多种编队队形（直线、三角形、菱形、自定义）
- 领航者跟踪参考轨迹
- 跟随者保持相对位置和姿态
- 考虑通信延迟和丢包
- 实现平滑的编队变换

要求：
- 使用虚拟结构法或行为基方法
- 添加碰撞避免机制
- 支持动态添加/移除无人机
- 提供编队状态监控接口
```

## 集成和测试 Prompts

### 8. 创建测试场景

```
请帮我创建一个测试场景的 Blueprint 或 C++ 代码，用于测试轨迹跟踪功能。

场景设置：
- 生成一个 8 字形参考轨迹
- 在场景中可视化参考轨迹（使用 DrawDebugLine）
- 创建一个无人机实例，跟踪该轨迹
- 实时显示跟踪误差（位置误差、速度误差）
- 记录飞行数据到 CSV 文件
- 添加可调节的参数面板（控制器增益、轨迹速度等）

请提供完整的实现代码和使用说明。
```

### 9. 性能分析

```
我的模拟器在运行 10 架无人机时帧率下降到 30fps。请帮我：

1. 分析可能的性能瓶颈（使用 UE5 的 Profiler 工具）
2. 检查 Physics/Control/Planning 模块的计算复杂度
3. 建议优化方案：
   - 多线程并行计算
   - 降低更新频率
   - 使用 LOD 系统
   - 优化算法复杂度
4. 实现关键的性能优化

请给出具体的代码修改建议。
```

### 10. 添加可视化调试工具

```
请创建一个调试可视化系统（Source/uav_simulator/Debug/DebugVisualizer.h/cpp），用于实时显示：

1. 无人机状态信息：
   - 位置、速度、姿态、角速度
   - 电机推力
   - 传感器数据

2. 轨迹可视化：
   - 历史轨迹（拖尾效果）
   - 规划轨迹
   - 参考轨迹

3. 传感器视锥：
   - 相机视野
   - 激光雷达扫描范围

4. 调试信息：
   - 控制器输出
   - 规划算法中间结果
   - 性能指标（帧率、计算时间）

要求：
- 使用 DrawDebugXXX 函数或 ULineBatchComponent
- 支持运行时开关
- 可配置显示内容和样式
- 性能开销小
```

## 高级功能 Prompts

### 11. ROS2 集成

```
请实现一个 ROS2 桥接模块，使 UAV Simulator 可以与 ROS2 系统通信。

功能需求：
- 发布无人机状态（位置、姿态、速度）到 ROS2 topic
- 订阅控制命令（目标位置、速度、姿态）
- 发布传感器数据（IMU、GPS、相机图像）
- 支持多无人机（使用命名空间）
- 使用标准 ROS2 消息类型（geometry_msgs, sensor_msgs, nav_msgs）

技术方案：
- 使用 rclcpp 库
- 在单独的线程中运行 ROS2 节点
- 实现消息转换（UE5 类型 <-> ROS2 消息）
- 处理坐标系转换（UE5 左手系 <-> ROS2 右手系）

请提供实现代码和编译配置说明。
```

### 12. 机器学习集成

```
我想使用强化学习训练无人机控制策略。请帮我：

1. 设计环境接口：
   - 状态空间：位置、速度、姿态、目标位置等
   - 动作空间：电机推力或期望姿态
   - 奖励函数：跟踪误差、能耗、平滑度等

2. 实现 Python 接口（使用 UnrealEnginePython 或 socket 通信）：
   - reset() - 重置环境
   - step(action) - 执行动作，返回 (state, reward, done, info)
   - render() - 可视化（可选）

3. 提供训练脚本示例（使用 Stable-Baselines3 或 PyTorch）

4. 实现训练好的策略部署到 C++ 控制器

请给出完整的实现方案和代码。
```

### 13. 复杂任务规划

```
请实现一个任务规划系统，支持以下任务类型：

1. 航点任务：按顺序飞过一系列航点
2. 区域覆盖：使用割草机模式覆盖指定区域
3. 目标跟踪：跟踪移动目标并保持相对位置
4. 协同搜索：多机协同搜索目标
5. 动态重规划：响应环境变化或任务失败

要求：
- 使用状态机或行为树实现任务执行
- 支持任务优先级和抢占
- 实现任务监控和异常处理
- 提供任务描述语言（JSON 或 XML）
- 可视化任务执行状态

请提供架构设计和核心代码实现。
```

## 文档和维护 Prompts

### 14. 生成 API 文档

```
请为 Source/uav_simulator/Control/ 目录下的所有类生成 API 文档。

要求：
- 使用 Doxygen 风格的注释
- 包含类的用途说明
- 每个公共函数的参数、返回值、使用示例
- 重要的私有成员变量说明
- 使用注意事项和限制

请更新代码中的注释，并生成 Markdown 格式的文档。
```

### 15. 代码重构

```
Source/uav_simulator/Planning/PathPlanner.cpp 文件已经超过 1000 行，变得难以维护。请帮我重构：

1. 分析代码结构，识别可以拆分的模块
2. 将不同的路径规划算法拆分到独立的类中
3. 提取公共接口和基类
4. 改进命名和代码组织
5. 添加必要的注释和文档

要求：
- 保持功能不变
- 提高代码可读性和可维护性
- 遵循 SOLID 原则
- 便于后续添加新算法

请给出重构方案和修改后的代码。
```

## 使用技巧

### 提供充分的上下文
在 prompt 中包含：
- 相关的代码文件路径
- 具体的需求和约束
- 技术参数和规格
- 预期的输入输出
- 参考资料或算法

### 迭代式开发
1. 先让 Claude 生成框架代码
2. 审查并提出修改意见
3. 逐步完善细节
4. 进行测试和优化

### 代码审查
定期让 Claude 审查代码：
- 性能优化
- 安全性检查
- 代码规范
- 潜在 bug

### 学习和理解
不仅要代码，还要理解：
```
请解释这段代码的工作原理，特别是：
1. 算法的数学原理
2. 为什么这样实现
3. 有哪些替代方案
4. 优缺点分析
```

## 注意事项

1. **明确需求**：提供清晰、具体的需求描述
2. **分步实现**：复杂功能分解为多个小任务
3. **代码审查**：生成的代码需要人工审查和测试
4. **性能考虑**：关注实时性能要求
5. **版本控制**：使用 git 管理代码变更
6. **测试验证**：每个模块都要充分测试
7. **文档同步**：及时更新文档和注释

## 快速参考

### 常用命令模板

```bash
# 创建新模块
"请在 Source/uav_simulator/[模块名]/ 创建 [类名].h 和 [类名].cpp，实现 [功能描述]"

# 实现算法
"请在 [文件路径] 中实现 [算法名]，输入是 [输入描述]，输出是 [输出描述]"

# 调试问题
"我遇到了 [问题描述]，相关代码在 [文件路径]，请帮我分析原因并修复"

# 优化代码
"请优化 [文件路径] 的性能，重点关注 [具体方面]"

# 添加功能
"请在现有的 [类名] 中添加 [功能描述]，要求 [具体要求]"
```

### 项目特定术语

- **UAV**: Unmanned Aerial Vehicle（无人机）
- **6-DOF**: Six Degrees of Freedom（六自由度）
- **EKF**: Extended Kalman Filter（扩展卡尔曼滤波）
- **MPC**: Model Predictive Control（模型预测控制）
- **RRT**: Rapidly-exploring Random Tree（快速探索随机树）
- **Snap**: 加加加速度（jerk 的导数）
- **FRD**: Front-Right-Down（前右下坐标系）
- **NED**: North-East-Down（北东地坐标系）
